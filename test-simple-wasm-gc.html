<!DOCTYPE html>
<html>
<head><title>Simple WASM GC Test</title></head>
<body>
  <h1>Simple WASM GC Test</h1>
  <div id="log"></div>

  <script type="text/wast">
(module
  (type $box (struct (field $val (mut i32))))
  (func $makeBox (export "makeBox") (param i32) (result (ref $box))
    local.get 0
    struct.new $box
  )
)
  </script>

  <script>
    setTimeout(() => {
      const box = window.makeBox(42);
      console.log('Box:', box);
      console.log('typeof box:', typeof box);
      console.log('Accessing box.foobar:', box.val);
      console.log('Accessing box.constructor:', box.constructor);
      if (box.constructor) {
        console.log('box.constructor.name:', box.constructor.name);
      }
      // console.log('Object.prototype.toString.call(box):', Object.prototype.toString.call(box));
      console.log('Object.getOwnPropertyNames(box):', JSON.stringify(Object.getOwnPropertyNames(box)));
      console.log('Object.keys(box):', JSON.stringify(Object.keys(box)));
      console.log('box[0]:', box[0]);
      console.log('0 in box:', 0 in box);

      // Try to set
      try {
        box[0] = 99;
        console.log('After set, box[0]:', box[0]);
      } catch (e) {
        console.log('Error setting:', e.message);
      }
    }, 500);
  </script>
</body>
</html>
